// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DepartmentDetails {
  id            Int      @id @default(autoincrement())
  department    String
  active_status Boolean  @default(true)
  delete_status Boolean  @default(false)
  createdAt     DateTime @default(now())
  createdBy     Int      @default(1)
  updatedAt     DateTime @default(now()) @updatedAt
  updatedBy     Int?
  // Relationship Fields
  usercreate    User     @relation("departmentUserCreate", fields: [createdBy], references: [id])
  userupdate    User?    @relation("departmentUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  Users         User[]   @relation("userDepartment")
}

model User {
  id                         Int                  @id @default(autoincrement())
  name                       String
  email                      String               @unique
  phonenumber                String?
  alternatenumber            String?
  bloodgroup                 String?
  usercode                   String               @unique
  username                   String               @unique
  password                   String // Hashed password
  is_login                   Boolean              @default(false)
  role_id                    Int?
  address                    String?
  city                       String?
  state                      String?
  pincode                    String?
  salary                     Float?
  department_id              Int?
  // Default fields
  active_status              Boolean              @default(true)
  delete_status              Boolean              @default(false)
  createdAt                  DateTime             @default(now())
  createdBy                  Int
  updatedAt                  DateTime             @updatedAt
  updatedBy                  Int?
  // Relationship Fields
  role                       Role?                @relation(fields: [role_id], references: [id])
  departmentDetails          DepartmentDetails?   @relation("userDepartment", fields: [department_id], references: [id])
  refreshToken               RefreshToken?
  // Relationship Tables
  vendorUserCreate           Vendor[]             @relation("vendorUserCreate")
  vendorUserUpdate           Vendor[]             @relation("vendorUserUpdate")
  customerUserCreate         Customer[]           @relation("customerUserCreate")
  customerUserUpdate         Customer[]           @relation("customerUserUpdate")
  customerSalePerson         Customer[]           @relation("customerSalePerson")
  customerDeliveryPerson     Customer[]           @relation("customerDeliveryPerson")
  categoryUserCreate         LensCategoryMaster[] @relation("categoryUserCreate")
  categoryUserUpdate         LensCategoryMaster[] @relation("categoryUserUpdate")
  materialUserCreate         LensMaterialMaster[] @relation("materialUserCreate")
  materialUserUpdate         LensMaterialMaster[] @relation("materialUserUpdate")
  coatingUserCreate          LensCoatingMaster[]  @relation("coatingUserCreate")
  coatingUserUpdate          LensCoatingMaster[]  @relation("coatingUserUpdate")
  brandUserCreate            LensBrandMaster[]    @relation("brandUserCreate")
  brandUserUpdate            LensBrandMaster[]    @relation("brandUserUpdate")
  typeUserCreate             LensTypeMaster[]     @relation("typeUserCreate")
  typeUserUpdate             LensTypeMaster[]     @relation("typeUserUpdate")
  productUserCreate          LensProductMaster[]  @relation("productUserCreate")
  productUserUpdate          LensProductMaster[]  @relation("productUserUpdate")
  priceUserCreate            LensPriceMaster[]    @relation("priceUserCreate")
  priceUserUpdate            LensPriceMaster[]    @relation("priceUserUpdate")
  businessCategoryUserCreate businessCategory[]   @relation("businessCategoryUserCreate")
  businessCategoryUserUpdate businessCategory[]   @relation("businessCategoryUserUpdate")
  departmentUserCreate       DepartmentDetails[]  @relation("departmentUserCreate")
  departmentUserUpdate       DepartmentDetails[]  @relation("departmentUserUpdate")
  priceMappingCreatedBy      PriceMapping[]       @relation("priceMappingCreatedBy")
  priceMappingUpdatedBy      PriceMapping[]       @relation("priceMappingUpdatedBy")
  FittingUserCreate          LensFittingMaster[]  @relation("FittingUserCreate")
  FittingUserUpdate          LensFittingMaster[]  @relation("FittingUserUpdate")
  DiaUserCreate              LensDiaMaster[]      @relation("DiaUserCreate")
  DiaUserUpdate              LensDiaMaster[]      @relation("DiaUserUpdate")
  TintingUserCreate          LensTintingMaster[]  @relation("TintingUserCreate")
  TintingUserUpdate          LensTintingMaster[]  @relation("TintingUserUpdate")
  saleOrderCreatedBy         SaleOrder[]          @relation("saleOrderCreatedBy")
  saleOrderUpdatedBy         SaleOrder[]          @relation("saleOrderUpdatedBy")
  saleOrderAssignedPerson    SaleOrder[]          @relation("saleOrderAssignedPerson")
  locationUserCreate         LocationMaster[]     @relation("locationUserCreate")
  locationUserUpdate         LocationMaster[]     @relation("locationUserUpdate")
  trayUserCreate             TrayMaster[]         @relation("trayUserCreate")
  trayUserUpdate             TrayMaster[]         @relation("trayUserUpdate")
  auditLogs                  AuditLog[]           @relation("auditLogUser")
  errorLogs                  ErrorLog[]           @relation("errorLogUser")
  errorLogsResolved          ErrorLog[]           @relation("errorLogResolver")
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @unique // "Admin", "Sales", "Inventory", "Accounts"
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  //Relationships Tables
  permissions Permission[]
  users       User[]
}

model Permission {
  id        Int      @id @default(autoincrement())
  action    String // "create", "read", "update", "delete"
  subject   String // "SaleOrder", "PurchaseOrder", etc.
  role_id   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // Relationships Fields 
  role      Role     @relation(fields: [role_id], references: [id])
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  token     String   @db.Text
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // Relationship Fields
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model businessCategory {
  id            Int        @id @default(autoincrement())
  name          String     @unique
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  // Relationship Tables
  active_status Boolean    @default(true)
  delete_status Boolean    @default(false)
  createdBy     Int
  updatedBy     Int?
  // Relationship Fields
  usercreate    User       @relation("businessCategoryUserCreate", fields: [createdBy], references: [id])
  userupdate    User?      @relation("businessCategoryUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  customers     Customer[] @relation("customerCategory")
}

model Customer {
  id                  Int               @id @default(autoincrement())
  code                String            @unique // e.g., "CUST-001"
  name                String
  shopname            String?
  phone               String?
  alternatephone      String?
  email               String
  address             String?
  city                String?
  state               String?
  pincode             String?
  businessCategory_id Int?
  gstin               String?
  credit_limit        Int?
  outstanding_credit  Int?
  notes               String?
  sale_person_id      Int?
  delivery_person_id  Int?
  // Default fields
  active_status       Boolean           @default(true)
  delete_status       Boolean           @default(false)
  createdAt           DateTime          @default(now())
  createdBy           Int
  updatedAt           DateTime          @updatedAt
  updatedBy           Int?
  // Relationship Fields
  category            businessCategory? @relation("customerCategory", fields: [businessCategory_id], references: [id])
  salePerson          User?             @relation("customerSalePerson", fields: [sale_person_id], references: [id])
  deliveryPerson      User?             @relation("customerDeliveryPerson", fields: [delivery_person_id], references: [id])
  usercreate          User              @relation("customerUserCreate", fields: [createdBy], references: [id])
  userupdate          User?             @relation("customerUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  saleOrders          SaleOrder[]
  dispatchCopies      DispatchCopy[]
  priceMappings       PriceMapping[]
}

model Vendor {
  id             Int             @id @default(autoincrement())
  code           String          @unique // e.g., "VEND-001"
  name           String
  shopname       String?
  phone          String?
  alternatephone String?
  email          String
  address        String?
  city           String?
  state          String?
  pincode        String?
  category       String?
  gstin          String?
  // Default fields
  active_status  Boolean         @default(true)
  delete_status  Boolean         @default(false)
  notes          String?
  createdAt      DateTime        @default(now())
  createdBy      Int
  updatedAt      DateTime        @updatedAt
  updatedBy      Int?
  // Relationship Fields
  usercreate     User            @relation("vendorUserCreate", fields: [createdBy], references: [id])
  userupdate     User?           @relation("vendorUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  purchaseOrders PurchaseOrder[]
}

model LensCategoryMaster {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  description        String?
  activeStatus       Boolean             @default(true)
  deleteStatus       Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?           @updatedAt
  createdBy          Int
  updatedBy          Int?
  // Relationships Fields
  Usercreated        User                @relation("categoryUserCreate", fields: [createdBy], references: [id])
  Userupdated        User?               @relation("categoryUserUpdate", fields: [updatedBy], references: [id])
  lensProductMasters LensProductMaster[]
  saleOrders         SaleOrder[]
}

model LensMaterialMaster {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  description        String?
  activeStatus       Boolean             @default(true)
  deleteStatus       Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?           @updatedAt
  createdBy          Int
  updatedBy          Int?
  // Relationships Fields
  Usercreated        User                @relation("materialUserCreate", fields: [createdBy], references: [id])
  Userupdated        User?               @relation("materialUserUpdate", fields: [updatedBy], references: [id])
  lensProductMasters LensProductMaster[]
  saleOrders         SaleOrder[]
}

model LensCoatingMaster {
  id               Int               @id @default(autoincrement())
  name             String            @unique
  short_name       String
  description      String?
  activeStatus     Boolean           @default(true)
  deleteStatus     Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime?         @updatedAt
  createdBy        Int
  updatedBy        Int?
  // Relationships Fields
  Usercreated      User              @relation("coatingUserCreate", fields: [createdBy], references: [id])
  Userupdated      User?             @relation("coatingUserUpdate", fields: [updatedBy], references: [id])
  lensPriceMasters LensPriceMaster[]
  saleOrders       SaleOrder[]
}

model LensFittingMaster {
  id            Int         @id @default(autoincrement())
  name          String      @unique
  short_name    String
  description   String?
  fitting_price Float?
  activeStatus  Boolean     @default(true)
  deleteStatus  Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime?   @updatedAt
  createdBy     Int
  updatedBy     Int?
  // Relationships Fields
  Usercreated   User        @relation("FittingUserCreate", fields: [createdBy], references: [id])
  Userupdated   User?       @relation("FittingUserUpdate", fields: [updatedBy], references: [id])
  saleOrders    SaleOrder[]
}

model LensDiaMaster {
  id           Int         @id @default(autoincrement())
  name         String      @unique
  short_name   String
  description  String?
  activeStatus Boolean     @default(true)
  deleteStatus Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime?   @updatedAt
  createdBy    Int
  updatedBy    Int?
  // Relationships Fields
  Usercreated  User        @relation("DiaUserCreate", fields: [createdBy], references: [id])
  Userupdated  User?       @relation("DiaUserUpdate", fields: [updatedBy], references: [id])
  saleOrders   SaleOrder[]
}

model LensTintingMaster {
  id            Int         @id @default(autoincrement())
  name          String      @unique
  short_name    String
  description   String?
  tinting_price Float?
  activeStatus  Boolean     @default(true)
  deleteStatus  Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime?   @updatedAt
  createdBy     Int
  updatedBy     Int?
  // Relationships Fields
  Usercreated   User        @relation("TintingUserCreate", fields: [createdBy], references: [id])
  Userupdated   User?       @relation("TintingUserUpdate", fields: [updatedBy], references: [id])
  saleOrders    SaleOrder[]
}

model LensBrandMaster {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  description        String?
  activeStatus       Boolean             @default(true)
  deleteStatus       Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?           @updatedAt
  createdBy          Int
  updatedBy          Int?
  // Relationships Fields
  Usercreated        User                @relation("brandUserCreate", fields: [createdBy], references: [id])
  Userupdated        User?               @relation("brandUserUpdate", fields: [updatedBy], references: [id])
  lensProductMasters LensProductMaster[]
}

model LensTypeMaster {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  description        String?
  activeStatus       Boolean             @default(true)
  deleteStatus       Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?           @updatedAt
  createdBy          Int
  updatedBy          Int?
  // Relationships Fields
  Usercreated        User                @relation("typeUserCreate", fields: [createdBy], references: [id])
  Userupdated        User?               @relation("typeUserUpdate", fields: [updatedBy], references: [id])
  lensProductMasters LensProductMaster[]
  saleOrders         SaleOrder[]
}

model LensProductMaster {
  id                    Int                @id @default(autoincrement())
  brand_id              Int
  category_id           Int
  material_id           Int
  type_id               Int
  product_code          String
  lens_name             String
  index_value           Int?
  sphere_min            Float?
  sphere_max            Float?
  sphere_extra_charge   Float?             @default(0) // Extra charge if sphere exceeds max
  cyl_min               Float?
  cyl_max               Float?
  cylinder_extra_charge Float?             @default(0) // Extra charge if cylinder exceeds max
  add_min               Float?
  add_max               Float?
  range_text            String?
  // Default fields
  activeStatus          Boolean            @default(true)
  deleteStatus          Boolean            @default(false)
  createdAt             DateTime           @default(now())
  updatedAt             DateTime?          @updatedAt
  createdBy             Int
  updatedBy             Int?
  // Relationships Fields
  brand                 LensBrandMaster    @relation(fields: [brand_id], references: [id])
  category              LensCategoryMaster @relation(fields: [category_id], references: [id])
  material              LensMaterialMaster @relation(fields: [material_id], references: [id])
  type                  LensTypeMaster     @relation(fields: [type_id], references: [id])
  Usercreated           User               @relation("productUserCreate", fields: [createdBy], references: [id])
  Userupdated           User?              @relation("productUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  lensPriceMasters      LensPriceMaster[]
  saleOrders            SaleOrder[]
}

model LensPriceMaster {
  id            Int               @id @default(autoincrement())
  lens_id       Int
  coating_id    Int
  price         Float
  activeStatus  Boolean           @default(true)
  deleteStatus  Boolean           @default(false)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime?         @updatedAt
  createdBy     Int
  updatedBy     Int?
  // Relationships Fields
  coating       LensCoatingMaster @relation(fields: [coating_id], references: [id])
  lens          LensProductMaster @relation(fields: [lens_id], references: [id])
  Usercreated   User              @relation("priceUserCreate", fields: [createdBy], references: [id])
  Userupdated   User?             @relation("priceUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  priceMappings PriceMapping[]
}

// Forward declarations for related models
enum SaleOrderStatus {
  DRAFT
  CONFIRMED
  IN_PRODUCTION
  READY_FOR_DISPATCH
  DELIVERED
}

model SaleOrderItem {
  id          Int       @id @default(autoincrement())
  saleOrderId Int
  saleOrder   SaleOrder @relation(fields: [saleOrderId], references: [id])
  quantity    Int       @default(1)
  price       Float // Price at time of sale
  discount    Float     @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

enum PaymentMethod {
  CASH
  UPI
  CARD
  BANK_TRANSFER
  CHECK
}

enum InvoiceStatus {
  DRAFT
  ISSUED
  PARTIALLY_PAID
  PAID
  CANCELLED
}

model Invoice {
  id          Int           @id @default(autoincrement())
  invoiceNo   String        @unique // e.g., INV-2025-001
  status      InvoiceStatus @default(DRAFT)
  saleOrders  SaleOrder[]
  totalAmount Float
  paidAmount  Float         @default(0)
  dueDate     DateTime
  payments    Payment[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Payment {
  id          Int           @id @default(autoincrement())
  invoiceId   Int
  invoice     Invoice       @relation(fields: [invoiceId], references: [id])
  amount      Float
  method      PaymentMethod
  referenceNo String? // For UPI/Card/Bank transactions
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

enum POStatus {
  PENDING
  ORDERED
  RECEIVED
  CANCELLED
}

model PurchaseOrder {
  id          Int        @id @default(autoincrement())
  poNumber    String     @unique // e.g., PO-2025-001
  vendorId    Int
  vendor      Vendor     @relation(fields: [vendorId], references: [id])
  status      POStatus   @default(PENDING)
  totalValue  Float
  notes       String?
  // items       POItem[]
  saleOrderId Int?
  saleOrder   SaleOrder? @relation(fields: [saleOrderId], references: [id])
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum DispatchStatus {
  PENDING
  IN_TRANSIT
  DELIVERED
}

model DispatchCopy {
  id            Int            @id @default(autoincrement())
  dcNumber      String         @unique // e.g., DC-2025-001
  customerId    Int
  customer      Customer       @relation(fields: [customerId], references: [id])
  status        DispatchStatus @default(PENDING)
  notes         String?
  vehicleNumber String?
  driverName    String?
  driverContact String?
  deliveryNotes String?
  saleOrders    SaleOrder[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

// model POItem {
//   id              Int           @id @default(autoincrement())
//   purchaseOrderId Int
//   purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id])
//   lensVariantId   Int
//   lensVariant     LensVariant   @relation(fields: [lensVariantId], references: [id])
//   quantity        Int
//   price           Float // Purchase price
//   notes           String?
//   createdAt       DateTime      @default(now())
//   updatedAt       DateTime      @updatedAt

//   
//   
// }

model PriceMapping {
  id            Int             @id @default(autoincrement())
  lensPrice_id  Int
  lensPrice     LensPriceMaster @relation(fields: [lensPrice_id], references: [id])
  customer_id   Int
  customer      Customer        @relation(fields: [customer_id], references: [id])
  discountRate  Float           @default(0) // Percentage discount for this customer on this lens price
  discountPrice Float           @default(0) // Calculated discount price after applying discount rate
  createdAt     DateTime        @default(now())
  createdBy     Int
  updatedAt     DateTime        @updatedAt
  updatedBy     Int?
  createdByUser User            @relation("priceMappingCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User?           @relation("priceMappingUpdatedBy", fields: [updatedBy], references: [id])
}

model SaleOrder {
  id                Int                 @id @default(autoincrement())
  orderNo           String              @unique // e.g., SO-2025-001
  customerId        Int
  customer          Customer            @relation(fields: [customerId], references: [id])
  status            SaleOrderStatus     @default(DRAFT)
  // Basic order information
  customerRefNo     String? // Customer reference number
  orderDate         DateTime            @default(now())
  type              String? // "Normal Processing", "Rush Processing", "Premium Processing"
  deliverySchedule  DateTime?
  remark            String?
  itemRefNo         String?
  freeLens          Boolean             @default(false)
  urgentOrder       Boolean             @default(false)
  freeFitting       Boolean             @default(false)
  // Lens details
  lens_id           Int?
  category_id       Int? // "Single Vision", "BiFocal", "Progressive", "Reading"
  Type_id           Int? // "Glass", "Plastic", "Polycarbonate", "Trivex"
  dia_id            Int?
  fitting_id        Int? // "Standard", "Premium", "Custom"
  material_id       Int? // Material type reference
  coating_id        Int? // "Anti-Reflection", "UV Protection", "Blue Light", "Scratch Resistant"
  tinting_id        Int? // "Clear", "Light Brown", "Dark Brown", "Gray", "Green"
  lensProduct       LensProductMaster?  @relation(fields: [lens_id], references: [id])
  category          LensCategoryMaster? @relation(fields: [category_id], references: [id])
  lensType          LensTypeMaster?     @relation(fields: [Type_id], references: [id])
  dia               LensDiaMaster?      @relation(fields: [dia_id], references: [id])
  fitting           LensFittingMaster?  @relation(fields: [fitting_id], references: [id])
  material          LensMaterialMaster? @relation(fields: [material_id], references: [id])
  coating           LensCoatingMaster?  @relation(fields: [coating_id], references: [id])
  tinting           LensTintingMaster?  @relation(fields: [tinting_id], references: [id])
  // Eye selection
  rightEye          Boolean             @default(false)
  leftEye           Boolean             @default(false)
  // Right eye specifications
  rightSpherical    String?
  rightCylindrical  String?
  rightAxis         String?
  rightAdd          String?
  rightDia          String?
  // rightBase, rightBaseSize, rightBled removed
  // Left eye specifications
  leftSpherical     String?
  leftCylindrical   String?
  leftAxis          String?
  leftAdd           String?
  leftDia           String?
  // leftBase, leftBaseSize, leftBled removed
  // Dispatch information
  dispatchStatus    String?             @default("Pending") // "Pending", "Assigned", "In Transit", "Delivered"
  assignedPerson_id Int?
  dispatchId        String?
  estimatedDate     DateTime?
  estimatedTime     String?
  actualDate        DateTime?
  actualTime        String?
  dispatchNotes     String?

  // Billing information
  lensPrice       Float           @default(0)
  rightEyeExtra   Float           @default(0)
  leftEyeExtra    Float           @default(0)
  fittingPrice    Float           @default(0)
  tintingPrice    Float           @default(0)
  discount        Float           @default(0) // Percentage discount
  additionalPrice Json? // For any additional charges
  // Relations
  items           SaleOrderItem[]
  invoice         Invoice?        @relation(fields: [invoiceId], references: [id])
  invoiceId       Int?
  purchaseOrders  PurchaseOrder[]
  dispatch        DispatchCopy?   @relation(fields: [dispatchCopyId], references: [id])
  dispatchCopyId  Int?
  // Default fields
  activeStatus    Boolean         @default(true)
  deleteStatus    Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  createdBy       Int
  updatedBy       Int?
  createdByUser   User            @relation("saleOrderCreatedBy", fields: [createdBy], references: [id])
  updatedByUser   User?           @relation("saleOrderUpdatedBy", fields: [updatedBy], references: [id])
  assignedPerson  User?           @relation("saleOrderAssignedPerson", fields: [assignedPerson_id], references: [id])
}

model LocationMaster {
  id            Int          @id @default(autoincrement())
  name          String
  location_code String       @unique
  description   String?
  activeStatus  Boolean      @default(true)
  deleteStatus  Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  createdBy     Int
  updatedBy     Int?
  // Relationship Fields
  createdByUser User         @relation("locationUserCreate", fields: [createdBy], references: [id])
  updatedByUser User?        @relation("locationUserUpdate", fields: [updatedBy], references: [id])
  // Relationship Tables
  trays         TrayMaster[]
}

model TrayMaster {
  id            Int             @id @default(autoincrement())
  name          String
  tray_code     String          @unique
  description   String?
  capacity      Int?
  location_id   Int?
  activeStatus  Boolean         @default(true)
  deleteStatus  Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  createdBy     Int
  updatedBy     Int?
  // Relationship Fields
  location      LocationMaster? @relation(fields: [location_id], references: [id])
  createdByUser User            @relation("trayUserCreate", fields: [createdBy], references: [id])
  updatedByUser User?           @relation("trayUserUpdate", fields: [updatedBy], references: [id])
}

// ============================================
// AUDIT LOG & ERROR LOG TABLES
// ============================================

model AuditLog {
  id           Int      @id @default(autoincrement())
  userId       Int?
  action       String // CREATE, UPDATE, DELETE, READ
  entity       String // Table/Model name (e.g., "SaleOrder", "Customer")
  entityId     Int? // ID of the affected record
  oldValues    Json? // Previous values (for UPDATE/DELETE)
  newValues    Json? // New values (for CREATE/UPDATE)
  changes      Json? // Specific field changes
  ipAddress    String?
  userAgent    String?
  method       String? // HTTP method (GET, POST, PUT, DELETE)
  endpoint     String? // API endpoint
  statusCode   Int? // HTTP status code
  success      Boolean  @default(true)
  errorMessage String?  @db.Text
  metadata     Json? // Additional context
  createdAt    DateTime @default(now())
  // Relationship
  user         User?    @relation("auditLogUser", fields: [userId], references: [id])
}

model ErrorLog {
  id            Int       @id @default(autoincrement())
  userId        Int?
  errorType     String // Type of error (e.g., "ValidationError", "DatabaseError")
  errorMessage  String    @db.Text
  errorStack    String?   @db.Text
  errorCode     String? // Custom error code
  statusCode    Int? // HTTP status code
  method        String? // HTTP method
  endpoint      String? // API endpoint
  requestBody   Json? // Request payload
  requestParams Json? // Query/path parameters
  ipAddress     String?
  userAgent     String?
  severity      String    @default("ERROR") // INFO, WARNING, ERROR, CRITICAL
  resolved      Boolean   @default(false)
  resolvedAt    DateTime?
  resolvedBy    Int?
  resolution    String?   @db.Text
  metadata      Json? // Additional error context
  createdAt     DateTime  @default(now())
  // Relationships
  user          User?     @relation("errorLogUser", fields: [userId], references: [id])
  resolver      User?     @relation("errorLogResolver", fields: [resolvedBy], references: [id])
}
